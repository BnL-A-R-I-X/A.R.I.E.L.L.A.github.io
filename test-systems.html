<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AxiomOC Database - System Tests</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="test-container">
        <h1>System Test Console</h1>
        
        <div class="test-section">
            <h2>Ranking System Test</h2>
            <div id="ranking-test-output"></div>
            <button onclick="testRankingSystem()">Test Ranking Save/Load</button>
        </div>
        
        <div class="test-section">
            <h2>Commission System Test</h2>
            <div id="commission-test-output"></div>
            <button onclick="testCommissionSystem()">Test Commission Save/Load</button>
        </div>
        
        <div class="test-section">
            <h2>Firebase Connection Test</h2>
            <div id="firebase-test-output"></div>
            <button onclick="testFirebaseConnection()">Test Firebase Status</button>
        </div>
    </div>

    <script type="module">
        // Test ranking system
        window.testRankingSystem = async function() {
            const output = document.getElementById('ranking-test-output');
            output.innerHTML = '<p>Testing ranking system...</p>';
            
            try {
                // Import and test the ranking system
                const module = await import('./js/firebase-ranking-system.js');
                const rankingSystem = new module.FirebaseRankingSystem();
                
                // Wait for initialization
                setTimeout(async () => {
                    try {
                        // Test vote saving
                        await rankingSystem.vote('ariella', 5);
                        
                        // Check if vote was saved
                        const userVotes = rankingSystem.userVotes;
                        const localData = localStorage.getItem('axiom-character-rankings');
                        
                        output.innerHTML = `
                            <p>✅ Ranking system test results:</p>
                            <p>Firebase Ready: ${rankingSystem.firebaseReady}</p>
                            <p>Vote saved in memory: ${userVotes.ariella ? '✅' : '❌'}</p>
                            <p>Vote saved locally: ${localData ? '✅' : '❌'}</p>
                            <p>Vote value: ${userVotes.ariella?.rating || 'Not found'}</p>
                        `;
                    } catch (error) {
                        output.innerHTML = `<p>❌ Error testing ranking: ${error.message}</p>`;
                    }
                }, 2000);
                
            } catch (error) {
                output.innerHTML = `<p>❌ Error loading ranking system: ${error.message}</p>`;
            }
        };
        
        // Test commission system
        window.testCommissionSystem = async function() {
            const output = document.getElementById('commission-test-output');
            output.innerHTML = '<p>Testing commission system...</p>';
            
            try {
                const module = await import('./js/firebase-commission-system.js');
                const commissionSystem = new module.FirebaseCommissionSystem();
                
                setTimeout(async () => {
                    try {
                        // Test commission creation
                        const testCommission = {
                            artist: 'Test Artist',
                            date: '2025-01-31',
                            description: 'Test commission',
                            character: 'Test Character',
                            cost: 100,
                            type: 'Digital Art',
                            status: 'planning'
                        };
                        
                        const result = await commissionSystem.addCommission(testCommission);
                        
                        output.innerHTML = `
                            <p>✅ Commission system test results:</p>
                            <p>Firebase Ready: ${commissionSystem.firebaseReady}</p>
                            <p>Commission added: ${result ? '✅' : '❌'}</p>
                            <p>Commission ID: ${result || 'Failed'}</p>
                        `;
                    } catch (error) {
                        output.innerHTML = `<p>❌ Error testing commission: ${error.message}</p>`;
                    }
                }, 2000);
                
            } catch (error) {
                output.innerHTML = `<p>❌ Error loading commission system: ${error.message}</p>`;
            }
        };
        
        // Test Firebase connection
        window.testFirebaseConnection = async function() {
            const output = document.getElementById('firebase-test-output');
            output.innerHTML = '<p>Testing Firebase connection...</p>';
            
            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getFirestore } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyB-dsFpr790H-m020Ojubbr5I_qAMEIwiY",
                    authDomain: "axiomocdatabase.firebaseapp.com",
                    projectId: "axiomocdatabase",
                    storageBucket: "axiomocdatabase.appspot.com",
                    messagingSenderId: "849872728406",
                    appId: "1:849872728406:web:cac277d51263cce20126f7",
                    measurementId: "G-H2DQJGWTKQ"
                };
                
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                output.innerHTML = `
                    <p>✅ Firebase connection test results:</p>
                    <p>App initialized: ✅</p>
                    <p>Firestore connected: ✅</p>
                    <p>Project ID: ${firebaseConfig.projectId}</p>
                `;
                
            } catch (error) {
                output.innerHTML = `<p>❌ Firebase connection error: ${error.message}</p>`;
            }
        };
    </script>

    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-primary);
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-secondary);
        }
        
        .test-section h2 {
            color: var(--accent-primary);
            margin-bottom: 15px;
        }
        
        .test-section button {
            background: var(--bg-button);
            color: var(--text-primary);
            border: 1px solid var(--border-primary);
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 0;
        }
        
        .test-section button:hover {
            background: var(--bg-button-hover);
            border-color: var(--accent-primary);
        }
        
        #ranking-test-output, #commission-test-output, #firebase-test-output {
            background: var(--bg-primary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            min-height: 100px;
            font-family: monospace;
        }
    </style>
</body>
</html>
