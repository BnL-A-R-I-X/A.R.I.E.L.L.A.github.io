<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="USS Axiom Administrative Control Panel - Unified management interface for commission systems, data operations, and ship maintenance.">
    <title>USS Axiom // Administrative Control</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/commission-admin-v2.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto&display=swap" rel="stylesheet">
</head>
<body>

<!-- Security Access Screen -->
<div id="security-screen" class="security-overlay">
  <div class="security-panel">
    <div class="security-header">
      <img src="../assets/logos/axiom.png" alt="BNL Logo" class="security-logo">
      <h1>üîí BNL SECURITY CHECKPOINT</h1>
      <p class="security-warning">ADMINISTRATIVE TERMINAL ACCESS</p>
      <p class="security-subtitle">Level 7 Clearance Required</p>
    </div>
    
    <div class="access-form">
      <label for="pincode" class="pin-label">Enter Security Code:</label>
      <input type="password" id="pincode" class="pin-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button id="access-btn" class="access-button">GRANT ACCESS</button>
      <button id="cancel-btn" class="cancel-button">CANCEL</button>
    </div>
    
    <div class="security-notice">
      <p>‚ö†Ô∏è UNAUTHORIZED ACCESS ATTEMPT WILL BE LOGGED</p>
      <p>BNL Security Protocol 3272-X Active</p>
    </div>
  </div>
</div>

<!-- Main Content (Hidden by default) -->
<div id="main-content" class="hidden">

<header class="site-header">
    <div class="header-inner">
        <img src="../assets/logos/axiom.png" alt="BNL Axiom Logo" class="bnl-logo small-centered" title="Buy n Large Corporation ‚Äî Property of USS Axiom">
        <div>
            <h1>üîí USS AXIOM // ADMINISTRATIVE CONTROL</h1>
            <p class="subtext">Unified System & Commission Management</p>
            <p class="status">STATUS: SECURED ‚Äî CLEARANCE: <strong>LEVEL 7 (ADMIN)</strong> ‚Äî USER: <strong>A.R.I.E.L.L.A</strong></p>
            <div class="status-widgets">
                SHIP TIME: <strong id="shipTime"></strong> |
                SECTOR: <strong>BNL-7 / ALPHA</strong> |
                UPLINK: <strong>ENCRYPTED</strong>
            </div>
        </div>
    </div>
</header>

<nav class="nav-bar nav-right">
    <a href="../index.html" class="nav-btn">HOME</a>
    
    <div class="nav-dropdown">
        <div class="nav-btn nav-dropdown-toggle">ARCHIVES</div>
        <div class="nav-dropdown-menu">
            <div class="nav-dropdown-header">BNL Archives</div>
            <a href="ocs.html" class="nav-dropdown-item">OC Database</a>
            <a href="#" class="nav-dropdown-item disabled coming-soon">Character Rankings [MAINTENANCE]</a>
            <a href="upcoming-commissions-v2.html" class="nav-dropdown-item">Commission Queue</a>
        </div>
    </div>
    
    <div class="nav-dropdown">
        <div class="nav-btn nav-dropdown-toggle">PROFILE</div>
        <div class="nav-dropdown-menu">
            <div class="nav-dropdown-header">üë§ User Profile</div>
            <a href="bio.html" class="nav-dropdown-item">Biography</a>
            <a href="socials.html" class="nav-dropdown-item">Social Links</a>
        </div>
    </div>
    
    <div class="nav-dropdown">
        <div class="nav-btn nav-dropdown-toggle">COMMUNITY</div>
        <div class="nav-dropdown-menu">
            <div class="nav-dropdown-header">Community Hub</div>
            <a href="#" class="nav-dropdown-item disabled coming-soon">Art Gallery</a>
            <a href="#" class="nav-dropdown-item disabled coming-soon">User Submissions</a>
            <a href="#" class="nav-dropdown-item disabled coming-soon">Featured Works</a>
        </div>
    </div>
    
    <div class="nav-dropdown">
        <div class="nav-btn nav-dropdown-toggle secret-btn current">ADMIN</div>
        <div class="nav-dropdown-menu">
            <div class="nav-dropdown-header">üîß Admin Panel</div>
            <a href="admin-v2.html" class="nav-dropdown-item active">Administrative Control</a>
        </div>
    </div>
</nav>

<section class="terminal-intro">
    <p>
        <strong>ADMINISTRATIVE CONTROL:</strong> Unified management interface for commission systems, data operations, and ship maintenance. 
        All actions are logged and monitored per BNL Security Protocol 3272-X.
        <em>Unauthorized access attempts will result in immediate lockdown and security team notification.</em>
    </p>
</section>

<main class="admin-container">
    
    <!-- Commission Statistics Dashboard -->
    <section class="stats-section">
        <h2>üìä Commission Statistics</h2>
        <div id="commission-stats" class="stats-grid">
            <!-- Stats will be populated by JavaScript -->
        </div>
    </section>

    <!-- Commission Management Section -->
    <section class="commission-section">
        <h2>üé® Commission Management</h2>
        
        <!-- Add New Commission Form -->
        <div class="commission-form-container">
            <h3>Add New Commission</h3>
            <form id="commission-form-v2" class="commission-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="title">Commission Title:</label>
                        <input type="text" id="title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="artist">Artist:</label>
                        <input type="text" id="artist" name="artist" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dateCommissioned">Date Commissioned:</label>
                        <input type="date" id="dateCommissioned" name="dateCommissioned">
                    </div>
                    <div class="form-group">
                        <label for="cost">Cost:</label>
                        <input type="text" id="cost" name="cost" placeholder="$0.00">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="character">Primary Character:</label>
                        <input type="text" id="character" name="character">
                    </div>
                    <div class="form-group">
                        <label for="additionalCharacters">Additional Characters:</label>
                        <input type="text" id="additionalCharacters" name="additionalCharacters" placeholder="Optional">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="type">Type:</label>
                        <select id="type" name="type" required>
                            <option value="">Select Type</option>
                            <option value="Character Design">Character Design</option>
                            <option value="Portrait">Portrait</option>
                            <option value="Full Body">Full Body</option>
                            <option value="Scene">Scene</option>
                            <option value="Reference Sheet">Reference Sheet</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="status">Status:</label>
                        <select id="status" name="status" required>
                            <option value="planning">Planning</option>
                            <option value="in-progress">In Progress</option>
                            <option value="review">Review</option>
                            <option value="completed">Completed</option>
                            <option value="on-hold">On Hold</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="description">Description:</label>
                    <textarea id="description" name="description" rows="4" placeholder="Detailed description of the commission..."></textarea>
                </div>

                <div class="form-group full-width">
                    <label for="notes">Notes:</label>
                    <textarea id="notes" name="notes" rows="2" placeholder="Additional notes or special instructions..."></textarea>
                </div>

                <div class="form-group full-width">
                    <label for="ideaImage">Reference Image (Optional):</label>
                    <input type="file" id="ideaImage" name="ideaImage" accept="image/*">
                    <small>Max file size: 5MB. Supported formats: JPG, PNG, GIF, WebP</small>
                    <div id="image-preview" class="image-preview-container" style="display: none;">
                        <img id="preview-img" src="" alt="Preview">
                        <button type="button" id="remove-image" class="remove-image-btn">Remove Image</button>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="isPublic" name="isPublic" checked>
                            <span class="checkmark"></span>
                            Public (visible on commission queue)
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-btn">Add Commission</button>
                    <button type="button" id="clear-form" class="clear-btn">Clear Form</button>
                </div>
            </form>
        </div>

        <!-- Commission List Controls -->
        <div class="commission-controls">
            <div class="search-filter-row">
                <div class="search-group">
                    <label for="search-commissions">Search:</label>
                    <input type="text" id="search-commissions" placeholder="Search commissions...">
                </div>
                <div class="filter-group">
                    <label for="filter-status">Filter by Status:</label>
                    <select id="filter-status">
                        <option value="all">All Statuses</option>
                        <option value="planning">Planning</option>
                        <option value="in-progress">In Progress</option>
                        <option value="review">Review</option>
                        <option value="completed">Completed</option>
                        <option value="on-hold">On Hold</option>
                    </select>
                </div>
                <div class="action-group">
                    <button id="export-commissions" class="action-btn">üìÅ Export</button>
                    <button id="import-commissions" class="action-btn">üìÇ Import</button>
                </div>
            </div>
        </div>

        <!-- Commission List -->
        <div id="commissions-list" class="commission-list">
            <!-- Commissions will be rendered here -->
        </div>
    </section>

    <!-- Theme Test Section -->
    <section class="theme-test-section">
        <h2>üé® Theme Testing Laboratory</h2>
        
        <div class="theme-warning">
            <h4>‚ö†Ô∏è TESTING NOTICE</h4>
            <p>Theme tests will temporarily override the site appearance. Use "Reset to Default" to restore normal theme.</p>
            <p>Some special themes (Pride, Trans, Earth Day) may include additional animations and effects.</p>
        </div>
        
        <div class="theme-test-grid">
            <button id="test-dark-theme" class="theme-test-btn dark-theme">
                üåô Test Dark Theme
            </button>
            <button id="test-pride-theme" class="theme-test-btn pride-theme">
                üè≥Ô∏è‚Äçüåà Test Pride Theme
            </button>
            <button id="test-trans-theme" class="theme-test-btn trans-theme">
                üè≥Ô∏è‚Äç‚ößÔ∏è Test Trans Theme
            </button>
            <button id="test-earth-theme" class="theme-test-btn earth-theme">
                üåç Test Earth Day Theme
            </button>
            <button id="reset-theme" class="theme-test-btn reset-theme">
                üîÑ Reset to Default
            </button>
        </div>
        
        <div class="theme-status">
            <h4>Theme Status</h4>
            <div id="current-theme-status" class="theme-status-info">
                Current Theme: <span id="active-theme" class="theme-status-active">Dark (Default)</span>
            </div>
            <div class="theme-status-info">
                Active Overlays: <span id="special-effects-status">None Active</span>
            </div>
            <div class="theme-status-info">
                Last Changed: <span id="theme-change-time">Page Load</span>
            </div>
            <div class="theme-status-info">
                Database Status: <span id="database-status">Ready</span>
            </div>
        </div>
    </section>

    <!-- Data Management Section -->
    <section class="admin-section">
        <h2>üìä Data Management</h2>
        <div class="admin-tools">
            <div class="tool-group">
                <h3>Commission System</h3>
                <button id="export-commissions-2" class="admin-btn">
                    üìÅ Export Commission Data
                </button>
                <button id="import-commissions-2" class="admin-btn">
                    üìÇ Import Commission Data
                </button>
                <button id="force-load-data" class="admin-btn load-data">
                    üîÑ Force Load Database
                </button>
                <div class="tool-info">
                    <p><strong>Storage:</strong> Firebase cloud database</p>
                    <p><strong>Collection:</strong> Firestore 'commissions'</p>
                    <p><strong>Format:</strong> JSON export with timestamp</p>
                    <p><strong>Load Data:</strong> Forces refresh of commission data from Firebase</p>
                </div>
            </div>
            
            <div class="tool-group">
                <h3>Character Rankings System</h3>
                <button id="export-rankings" class="admin-btn">
                    üìä Download Rankings Data
                </button>
                <button id="clear-rankings" class="admin-btn danger">
                    üóëÔ∏è Clear All Rankings
                </button>
                <div class="tool-info">
                    <p><strong>Storage:</strong> Local browser data management</p>
                    <p><strong>Format:</strong> JSON export with timestamp</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Security & Access Reference -->
    <section class="admin-section password-section">
        <h2>üîê Security Access Reference</h2>
        <div class="password-grid">
            <div class="password-card commission-access">
                <div class="password-header">
                    <h3>üé® Commission Ideas Access</h3>
                    <span class="access-level">PUBLIC TIER</span>
                </div>
                <div class="password-display">
                    <span class="password-label">Password:</span>
                    <span class="password-value">AxiomCreative2025</span>
                    <button class="copy-btn" data-copy="AxiomCreative2025">üìã</button>
                </div>
                <p class="password-description">Grants access to the protected Commission Ideas section on the public queue page.</p>
            </div>
            
            <div class="password-card admin-access">
                <div class="password-header">
                    <h3>üîí Administrative Control</h3>
                    <span class="access-level">ADMIN TIER</span>
                </div>
                <div class="password-display">
                    <span class="password-label">Security PIN:</span>
                    <span class="password-value">3272</span>
                    <button class="copy-btn" data-copy="3272">üìã</button>
                </div>
                <p class="password-description">Main administrative interface PIN for managing commissions and system data.</p>
            </div>
        </div>
    </section>

</main>

<section class="system-footer">
    <p>¬© 2025 Ariella Fawnbrook // USS Axiom Administrative Control</p>
    <p>BNL / AXIOM ADMIN INTERFACE ‚Äî VERSION 4.0</p>
</section>

<div class="status-ticker">
    <marquee behavior="scroll" direction="left">
        ADMIN ACCESS: Administrative control active. ‚Äî SECURITY LEVEL: MAXIMUM ‚Äî All actions are monitored and logged ‚Äî COMMISSION SYSTEM: OPERATIONAL ‚Äî DATA MANAGEMENT: ACTIVE
    </marquee>
</div>

</div>

<script>
// Initialize Firebase Commission System
let commissionSystemV2;

// Security PIN system
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Firebase commission system as commissionSystemV2 for compatibility
    if (window.FirebaseCommissionSystem) {
        commissionSystemV2 = new window.FirebaseCommissionSystem();
        window.commissionSystemV2 = commissionSystemV2;
        console.log('üî• Firebase commission system initialized for admin');
        
        // Wait for Firebase to load data, then initialize admin interface
        const waitForData = setInterval(() => {
            if (window.CommissionAdminV2 && commissionSystemV2.firebaseReady) {
                clearInterval(waitForData);
                window.commissionAdminV2 = new window.CommissionAdminV2();
                console.log('üîß Commission Admin V2 interface initialized');
                console.log('üìä Current commission count:', commissionSystemV2.getAllCommissions().length);
                
                // Force initial render after a short delay to ensure everything is loaded
                setTimeout(() => {
                    if (window.commissionAdminV2) {
                        console.log('üîÑ Forcing initial render...');
                        window.commissionAdminV2.renderCommissions();
                        window.commissionAdminV2.updateStats();
                    }
                }, 500);
            }
        }, 200);
    } else {
        // Wait for Firebase to load
        const checkFirebase = setInterval(() => {
            if (window.FirebaseCommissionSystem) {
                clearInterval(checkFirebase);
                commissionSystemV2 = new window.FirebaseCommissionSystem();
                window.commissionSystemV2 = commissionSystemV2;
                console.log('üî• Firebase commission system initialized for admin (delayed)');
                
                // Wait for Firebase to load data, then initialize admin interface
                const waitForData = setInterval(() => {
                    if (window.CommissionAdminV2 && commissionSystemV2.firebaseReady) {
                        clearInterval(waitForData);
                        window.commissionAdminV2 = new window.CommissionAdminV2();
                        console.log('üîß Commission Admin V2 interface initialized (delayed)');
                        console.log('üìä Current commission count:', commissionSystemV2.getAllCommissions().length);
                        
                        // Force initial render after a short delay to ensure everything is loaded
                        setTimeout(() => {
                            if (window.commissionAdminV2) {
                                console.log('üîÑ Forcing initial render (delayed)...');
                                window.commissionAdminV2.renderCommissions();
                                window.commissionAdminV2.updateStats();
                            }
                        }, 500);
                    }
                }, 200);
            }
        }, 100);
    }
    
    const pinInput = document.getElementById('pincode');
    const accessBtn = document.getElementById('access-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const securityScreen = document.getElementById('security-screen');
    const mainContent = document.getElementById('main-content');
    
    const correctPin = '3272'; // BNL Security Protocol 3272-X
    
    function checkAccess() {
        const enteredPin = pinInput.value;
        if (enteredPin === correctPin) {
            securityScreen.classList.add('hidden');
            mainContent.classList.remove('hidden');
            
            // Initialize ship time
            if (typeof initializeShipTime === 'function') {
                initializeShipTime();
            }
        } else {
            pinInput.style.borderColor = '#f44336';
            pinInput.style.animation = 'shake 0.5s';
            setTimeout(() => {
                pinInput.style.borderColor = '';
                pinInput.style.animation = '';
                pinInput.value = '';
            }, 500);
        }
    }
    
    function cancelAccess() {
        window.location.href = '../index.html';
    }
    
    accessBtn.addEventListener('click', checkAccess);
    cancelBtn.addEventListener('click', cancelAccess);
    
    pinInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            checkAccess();
        }
    });
    
    // Auto-focus pin input
    pinInput.focus();
    
    // Add confirmation dialog after admin system is loaded
    function addConfirmationDialog() {
        const commissionForm = document.getElementById('commission-form-v2');
        if (commissionForm && window.commissionAdminV2) {
            // Store the original handleFormSubmit method
            const originalHandleFormSubmit = window.commissionAdminV2.handleFormSubmit.bind(window.commissionAdminV2);
            
            // Override the handleFormSubmit method to add confirmation
            window.commissionAdminV2.handleFormSubmit = function(e) {
                // Get form data for preview
                const formData = new FormData(e.target);
                const title = formData.get('title') || 'Untitled';
                const artist = formData.get('artist') || 'Unknown Artist';
                const cost = formData.get('cost') || '$0.00';
                const status = formData.get('status') || 'planning';
                
                // Create confirmation message
                const confirmMessage = `Are you sure you want to add this commission?\n\n` +
                                     `Title: ${title}\n` +
                                     `Artist: ${artist}\n` +
                                     `Cost: ${cost}\n` +
                                     `Status: ${status}\n\n` +
                                     `This will be saved to the Firebase database.`;
                
                // Show confirmation dialog
                if (!confirm(confirmMessage)) {
                    e.preventDefault();
                    return false;
                }
                
                // If confirmed, call the original handler
                return originalHandleFormSubmit(e);
            };
            
            console.log('‚úÖ Confirmation dialog added to commission form');
        } else {
            // Retry after a short delay
            setTimeout(addConfirmationDialog, 100);
        }
    }
    
    // Start trying to add confirmation dialog
    addConfirmationDialog();
    
    // Theme Testing System
    function initThemeTestSystem() {
        const themeButtons = {
            'test-dark-theme': () => testTheme('dark', 'Dark Theme'),
            'test-pride-theme': () => testPrideTheme(),
            'test-trans-theme': () => testTransTheme(),
            'test-earth-theme': () => testEarthTheme(),
            'reset-theme': () => resetToDefault()
        };
        
        // Add event listeners for theme test buttons
        Object.keys(themeButtons).forEach(id => {
            const button = document.getElementById(id);
            if (button) {
                button.addEventListener('click', (e) => {
                    try {
                        console.log(`üé® Testing theme: ${id}`);
                        themeButtons[id]();
                    } catch (error) {
                        console.error(`Theme test error for ${id}:`, error);
                        alert(`Error testing theme: ${error.message}`);
                    }
                });
                console.log(`‚úÖ Added listener for ${id}`);
            } else {
                console.warn(`‚ùå Button not found: ${id}`);
            }
        });
        
        // Add force load data button functionality
        const loadDataBtn = document.getElementById('force-load-data');
        if (loadDataBtn) {
            loadDataBtn.addEventListener('click', forceLoadData);
            console.log('‚úÖ Added listener for force-load-data');
        }
        
        // Update status on load
        updateThemeStatus();
    }
    
    function testTheme(theme, themeName) {
        // Apply theme using existing theme manager if available
        if (window.themeManager) {
            window.themeManager.applyTheme(theme);
        } else {
            document.documentElement.setAttribute('data-theme', theme);
        }
        
        updateThemeStatus(themeName, 'None Active');
        
        // Use simple alert for better compatibility
        alert(`${themeName} activated! Check the site appearance.`);
    }
    
    function forceLoadData() {
        if (window.commissionSystemV2) {
            try {
                console.log('üîÑ Force loading commission data...');
                
                // Show loading indicator
                const button = document.getElementById('force-load-data');
                const originalText = button.innerHTML;
                button.innerHTML = '‚è≥ Loading...';
                button.disabled = true;
                
                // Update database status
                updateThemeStatus(null, null, 'Loading...');
                
                // Force reload data from Firebase
                window.commissionSystemV2.loadCommissions().then(() => {
                    console.log('‚úÖ Commission data loaded successfully');
                    
                    // Update admin interface if available
                    if (window.commissionAdminV2) {
                        window.commissionAdminV2.renderCommissions();
                        window.commissionAdminV2.updateStats();
                    }
                    
                    // Restore button
                    button.innerHTML = originalText;
                    button.disabled = false;
                    
                    // Update database status
                    updateThemeStatus(null, null, 'Data Loaded');
                    
                    alert('‚úÖ Commission data loaded successfully from Firebase!');
                }).catch((error) => {
                    console.error('‚ùå Error loading commission data:', error);
                    
                    // Restore button
                    button.innerHTML = originalText;
                    button.disabled = false;
                    
                    // Update database status
                    updateThemeStatus(null, null, 'Load Error');
                    
                    alert('‚ùå Error loading commission data: ' + error.message);
                });
            } catch (error) {
                console.error('‚ùå Error in force load:', error);
                updateThemeStatus(null, null, 'Error');
                alert('‚ùå Error: ' + error.message);
            }
        } else {
            updateThemeStatus(null, null, 'System Not Ready');
            alert('‚ùå Commission system not initialized yet. Please wait a moment and try again.');
        }
    }
    
    function testPrideTheme() {
        // Load and activate pride theme
        if (window.PrideMonthSpecial) {
            try {
                const prideSystem = new window.PrideMonthSpecial();
                prideSystem.forceActivate();
                updateThemeStatus('Pride Month Special', 'Rainbow animations, pride ticker');
            } catch (error) {
                console.error('Pride theme error:', error);
                applyFallbackPrideTheme();
            }
        } else {
            applyFallbackPrideTheme();
        }
        
        alert('üè≥Ô∏è‚Äçüåà Pride Theme activated! Rainbow power engaged!');
    }
    
    function applyFallbackPrideTheme() {
        // Don't remove existing themes, just add pride theme
        const existingStyle = document.getElementById('test-pride-theme');
        if (existingStyle) existingStyle.remove();
        
        // Fallback: apply basic pride styling
        const style = document.createElement('style');
        style.id = 'test-pride-theme';
        style.textContent = `
            body {
                background: linear-gradient(45deg, #e40303 0%, #ff8c00 16%, #ffed00 32%, #008018 48%, #004cff 64%, #732982 80%) !important;
                animation: prideShimmer 3s ease-in-out infinite alternate;
            }
            @keyframes prideShimmer {
                0% { filter: brightness(1); }
                100% { filter: brightness(1.2); }
            }
            .site-header { 
                background: rgba(0,0,0,0.8) !important; 
                border-bottom: 2px solid #ff69b4;
            }
            h1:not(.theme-test-section h1):not(.theme-test-section h2):not(.theme-test-section h3):not(.theme-test-section h4), 
            h2:not(.theme-test-section h2), 
            h3:not(.theme-test-section h3) { 
                background: linear-gradient(45deg, #e40303, #ff8c00, #ffed00, #008018, #004cff, #732982);
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-size: 200% 200%;
                animation: rainbowText 2s ease-in-out infinite alternate;
            }
            @keyframes rainbowText {
                0% { background-position: 0% 50%; }
                100% { background-position: 100% 50%; }
            }
            /* Protect theme test section */
            .theme-test-section, .theme-test-section * {
                background: initial !important;
                color: initial !important;
                animation: none !important;
            }
        `;
        document.head.appendChild(style);
        updateThemeStatus('Pride Theme (Basic)', 'Pride colors active');
    }
    
    function testTransTheme() {
        // Load and activate trans awareness theme
        if (window.TransAwarenessSpecial) {
            try {
                const transSystem = new window.TransAwarenessSpecial();
                transSystem.forceActivate();
                updateThemeStatus('Trans Awareness Special', 'Trans pride colors, special ticker');
            } catch (error) {
                console.error('Trans theme error:', error);
                applyFallbackTransTheme();
            }
        } else {
            applyFallbackTransTheme();
        }
        
        alert('üè≥Ô∏è‚Äç‚ößÔ∏è Trans Theme activated! Trans pride colors engaged!');
    }
    
    function applyFallbackTransTheme() {
        // Don't remove existing themes, just add trans theme
        const existingStyle = document.getElementById('test-trans-theme');
        if (existingStyle) existingStyle.remove();
        
        // Fallback: apply basic trans styling
        const style = document.createElement('style');
        style.id = 'test-trans-theme';
        style.textContent = `
            .admin-container:not(.theme-test-section) { 
                background: linear-gradient(45deg, rgba(85, 205, 252, 0.3), rgba(247, 168, 184, 0.3), rgba(255, 255, 255, 0.3)) !important;
                border: 2px solid #55cdfc;
            }
            .stats-section .stat-card { 
                border-color: #55cdfc !important; 
                background: linear-gradient(135deg, rgba(85, 205, 252, 0.2), rgba(247, 168, 184, 0.2)) !important;
            }
            .password-card { border-color: #55cdfc !important; }
            .commission-form-container, .commission-controls, .commission-list { 
                background: rgba(85, 205, 252, 0.1) !important;
                border-color: #55cdfc !important;
            }
            /* Protect theme test section */
            .theme-test-section, .theme-test-section * {
                background: initial !important;
                border-color: initial !important;
            }
        `;
        document.head.appendChild(style);
        updateThemeStatus('Trans Theme (Basic)', 'Trans pride colors active');
    }
    
    function testEarthTheme() {
        // Load and activate earth day theme
        if (window.EarthDaySpecial) {
            try {
                const earthSystem = new window.EarthDaySpecial();
                earthSystem.forceActivate();
                updateThemeStatus('Earth Day Special', 'Green theme, plant animations, EVE overlay');
            } catch (error) {
                console.error('Earth theme error:', error);
                applyFallbackEarthTheme();
            }
        } else {
            applyFallbackEarthTheme();
        }
        
        alert('üåç Earth Day Theme activated! Going green!');
    }
    
    function applyFallbackEarthTheme() {
        // Don't remove existing themes, just add earth theme
        const existingStyle = document.getElementById('test-earth-theme');
        if (existingStyle) existingStyle.remove();
        
        // Fallback: apply basic earth styling
        const style = document.createElement('style');
        style.id = 'test-earth-theme';
        style.textContent = `
            .admin-container:not(.theme-test-section) { 
                background: linear-gradient(135deg, rgba(27, 94, 32, 0.8), rgba(46, 125, 50, 0.8), rgba(56, 142, 60, 0.8)) !important;
                border: 2px solid #4caf50;
            }
            .commission-form-container, .commission-controls, .commission-list { 
                background: rgba(27, 94, 32, 0.6) !important;
                border-color: #4caf50 !important;
            }
            .stats-section .stat-card { 
                border-color: #4caf50 !important; 
                background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(139, 195, 74, 0.3)) !important;
            }
            .password-card { border-color: #4caf50 !important; }
            .admin-section:not(.theme-test-section) { border-color: #4caf50 !important; }
            /* Protect theme test section */
            .theme-test-section, .theme-test-section * {
                background: initial !important;
                border-color: initial !important;
            }
        `;
        document.head.appendChild(style);
        updateThemeStatus('Earth Day Theme (Basic)', 'Green theme active');
    }
    
    function removeTestThemes() {
        const testStyles = ['test-pride-theme', 'test-trans-theme', 'test-earth-theme'];
        testStyles.forEach(id => {
            const style = document.getElementById(id);
            if (style) style.remove();
        });
    }
    
    function resetToDefault() {
        // Remove all test themes
        removeTestThemes();
        
        // Deactivate special systems if they exist
        try {
            if (window.prideMonthSpecial) {
                window.prideMonthSpecial.deactivate();
            }
            if (window.transAwarenessSpecial) {
                window.transAwarenessSpecial.deactivate();
            }
            if (window.earthDaySpecial) {
                window.earthDaySpecial.deactivate();
            }
        } catch (error) {
            console.log('No special systems to deactivate:', error);
        }
        
        // Reset to default dark theme
        if (window.themeManager) {
            window.themeManager.applyTheme('dark');
        } else {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
        
        updateThemeStatus('Dark (Default)', 'None Active');
        
        alert('üîÑ Theme reset to default dark mode!');
    }
    
    function updateThemeStatus(themeName = null, effects = null, dbStatus = null) {
        const activeThemeElement = document.getElementById('active-theme');
        const effectsElement = document.getElementById('special-effects-status');
        const timeElement = document.getElementById('theme-change-time');
        const dbStatusElement = document.getElementById('database-status');
        
        if (activeThemeElement && themeName) {
            activeThemeElement.textContent = themeName;
        }
        
        if (effectsElement && effects !== null) {
            effectsElement.textContent = effects;
        }
        
        if (timeElement) {
            timeElement.textContent = new Date().toLocaleTimeString();
        }
        
        if (dbStatusElement && dbStatus !== null) {
            dbStatusElement.textContent = dbStatus;
        }
    }
    
    // Initialize theme test system
    setTimeout(() => {
        initThemeTestSystem();
        
        // Add debug logging for theme buttons
        console.log('üé® Theme test system initialized');
        console.log('Theme buttons found:', {
            'dark': !!document.getElementById('test-dark-theme'),
            'pride': !!document.getElementById('test-pride-theme'),
            'trans': !!document.getElementById('test-trans-theme'),
            'earth': !!document.getElementById('test-earth-theme'),
            'reset': !!document.getElementById('reset-theme'),
            'load-data': !!document.getElementById('force-load-data')
        });
    }, 500);
    
    // Copy button functionality
    document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const textToCopy = this.getAttribute('data-copy');
            navigator.clipboard.writeText(textToCopy).then(() => {
                if (typeof customDialogs !== 'undefined') {
                    customDialogs.alert('Copied to clipboard: ' + textToCopy);
                } else {
                    alert('Copied to clipboard: ' + textToCopy);
                }
            }).catch(() => {
                alert('Failed to copy to clipboard');
            });
        });
    });

    // Data Management Functions
    const exportBtn = document.getElementById('export-rankings');
    const clearBtn = document.getElementById('clear-rankings');
    
    if (exportBtn) {
        exportBtn.addEventListener('click', function() {
            const rankings = localStorage.getItem('characterRankings');
            if (rankings) {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(rankings);
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "axiom_rankings_" + new Date().toISOString().split('T')[0] + ".json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                
                alert('Rankings data exported successfully!');
            } else {
                alert('No rankings data found to export.');
            }
        });
    }
    
    if (clearBtn) {
        clearBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all character rankings data? This action cannot be undone.')) {
                localStorage.removeItem('characterRankings');
                alert('All rankings data has been cleared.');
            }
        });
    }
});
</script>

<script src="../js/firebase-commission-system.js"></script>
<script src="../js/commission-admin-v2.js"></script>
<script src="../js/custom-dialogs.js"></script>
<script src="../js/nav-dropdowns.js"></script>
<script src="../js/shiptime.js"></script>
<script src="../js/theme-toggle.js"></script>
<script src="../js/pride-month-special.js"></script>
<script src="../js/trans-awareness-special.js"></script>
<script src="../js/earth-day-special.js"></script>

</body>
</html>
